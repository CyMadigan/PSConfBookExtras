{
    "vSphere": {
        "VMHost": "cluster",
        "Storage": "vsanDatastore"
    },
    "VM": [
        {
            "Name": "UbuntuPS",
            "Cleanup": true,
            "Deploy": true,
            "DiskStorageFormat": "Thin",
            "OVA": "D:\\Repository\\Linux\\Ubuntu\\bionic-server-cloudimg-amd64.ova",
            "VMNote": "PS platform on ubuntu (#timestamp#)",
            "TimeZone": "Europe/Brussels",
            "User": "luc",
            "UserDisplayName": "LucD",
            "UserPswdHash": "$6$Homelab$TkNIJHlD5yltbzc5YUY2MRtAUHjk7tla8mHcr7oeXzAwHsSsoe0Mn3ZZIAk/VWr7zi1zaQAh65rVM2drxruvR1",
            "DefaultUser": "default-user",
            "DefaultUserPswdHash": "$6$Homelab$TkNIJHlD5yltbzc5YUY2MRtAUHjk7tla8mHcr7oeXzAwHsSsoe0Mn3ZZIAk/VWr7zi1zaQAh65rVM2drxruvR1",
            "RootPswdHash": "$6$Homelab$TkNIJHlD5yltbzc5YUY2MRtAUHjk7tla8mHcr7oeXzAwHsSsoe0Mn3ZZIAk/VWr7zi1zaQAh65rVM2drxruvR1",
            "Network": {
                "PortGroup": "vdPg1",
                "IPAddress": "192.168.10.83",
                "Netmask": "24",
                "Gateway": "192.168.10.1",
                "DNSServers": "192.168.10.2 192.168.10.3",
                "Domain": "local.lab",
                "NTPServers": "192.168.10.2 192.168.10.3"
            },
            "CloudConfig": [
                "#cloud-config",
                "hostname: $($vmInfo.Name)",
                "fqdn: $($vmInfo.Name).$($vmInfo.Network.Domain)",
                "write_files:",
                "- path: /etc/netplan/50-cloud-init.yaml",
                "  content: |",
                "    network:",
                "     version: 2",
                "     ethernets:",
                "      ens192:",
                "       addresses: [$($vmInfo.Network.IPAddress)/$($vmInfo.Network.Netmask)]",
                "       gateway4: $($vmInfo.Network.Gateway)",
                "       dhcp6: false",
                "       nameservers:",
                "         addresses:",
                "           - $($vmInfo.Network.DNSServers.Split(' ')[0])",
                "           - $($vmInfo.Network.DNSServers.Split(' ')[1])",
                "         search:",
                "           - $($vmInfo.Network.Domain)",
                "       dhcp4: false",
                "       optional: true",
                "- path: /etc/sysctl.d/60-disable-ipv6.conf",
                "  owner: root",
                "  content: |",
                "    net.ipv6.conf.all.disable_ipv6=1",
                "    net.ipv6.conf.default.disable_ipv6=1",
                "runcmd:",
                "- netplan --debug apply",
                "- sysctl -w net.ipv6.conf.all.disable_ipv6=1",
                "- sysctl -w net.ipv6.conf.default.disable_ipv6=1",
                "- apt -y autoremove",
                "snap:",
                "  commands:",
                "    00: ['install', 'powershell', '--classic']",
                "timezone: $($vmInfo.TimeZone)",
                "system_info:",
                "  default_user:",
                "    name: $($vmInfo.DefaultUser)",
                "    lock_passwd: false",
                "    sudo: ['ALL=(ALL) NOPASSWD:ALL']",
                "password: $($vmInfo.DefaultUserPswdHash)",
                "chpasswd: { expire: false }",
                "disable_root: false",
                "ssh_pwauth: yes",
                "users:",
                "  - default",
                "  - name: $($vmInfo.User)",
                "    gecos: $($vmInfo.UserDisplayName)",
                "    lock_passwd: false",
                "    groups: sudo, users, admin",
                "    shell: /bin/bash",
                "    sudo: ['ALL=(ALL) NOPASSWD:ALL']",
                "chpasswd:",
                "  list: |",
                "    $($vmInfo.DefaultUser):$($vmInfo.DefaultUserPswdHash)",
                "    $($vmInfo.User):$($vmInfo.UserPswdHash)",
                "    root:$($vmInfo.RootPswdHash)",
                "  expire: false",
                "package_upgrade: true",
                "package_reboot_if_required: true"
            ]
        }
    ]
}